<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    
     <mapper namespace="com.spring.magicMall.user.repository.IUserMapper">
     
	   
	   <!-- db와 필드 매핑 -->
		<resultMap id="resultMap" type="com.spring.magicMall.user.model.UserVO">
			<id property="userNO" column="user_no"/>
			<result property="id" column="id"/>
			<result property="password" column="password"/>
			<result property="name" column="name"/>
			<result property="email" column="email"/>
			<result property="pNumber" column="p_number"/>
			<result property="passCheckQuestion" column="pass_check_question"/>
			<result property="passCheckAnswer" column="pass_check_answer"/>
			<result property="regDate" column="reg_date"/>
			<result property="savedMoney" column="saved_money"/>
		</resultMap>
	
		<!-- 유저 회원 가입 -->
		<insert id="register">
			INSERT INTO user
			(id,password,name,email,p_number,pass_check_question,pass_check_answer)
			values
			(#{id},#{password},#{name},#{email},#{pNumber},#{passCheckQuestion},#{passCheckAnswer});
		</insert>
		
		<!-- 유저 탈퇴 -->
		<delete id="dropUser">
			DELETE FROM user
			WHERE user_no = #{userNO}		
		</delete>
		
		<!-- 유저 로그인(회원 가입시 인증 에도 사용) -->
		<select id ="login" resultMap="resultMap">
			SELECT * FROM user
			ORDER BY user_no DESC;
		</select>
		
		<!-- 아이디 찾기, 비밀번호 찾기 -->
		<select id="findIdAndPass" resultMap="resultMap">
			SELECT * FROM user
			WHERE email = #{email};
		</select>
		
		<!-- 아이디 중복 확인 -->
		<select id="checkId" resultType="int">
			select count(*) from user
			where id =#{id}		
		</select>
		
		<!-- 유저 번호 뽑아내기 -->
		<select id="findUserNO" resultType="int">
			SELECT user_no FROM user 
			WHERE id = #{id};
		
		</select>
		
		<!-- 마이페이지 에서 적립금 표시 하는 기능(마이페이지 표시기능도 포함) -->
		<select id="oneUser" resultMap="resultMap">
			SELECT * FROM user WHERE user_no = #{userNO};
		</select>
		
		<!-- 유저 검색 하기 -->
		<select id="findUser" resultMap="resultMap">
			SELECT * FROM user
			WHERE id =#{id}
			ORDER BY user_no DESC;
		</select>
		
		<!-- 비밀 번호 변경 -->
		<update id="changePassword">
			UPDATE user SET password = #{password}
			WHERE user_no = #{userNO};
		</update>
		
		<!-- 적립금 빼기 -->
		<update id="minSavedMoney">
			UPDATE user SET saved_money = saved_money-#{savedMoney}
			WHERE user_no = #{userNO};
		</update>
		
		<!-- 적립금 더하기 -->
		<update id="addSavedMoney">
			UPDATE user SET saved_money = saved_money+#{savedMoney}
			WHERE user_no = #{userNO};
		</update>
		
		<!-- 회원 정보 변경 -->
		<update id="editUser">
			UPDATE user 
			SET password = #{password}, p_number = #{pNumber}, email = #{email}
			where user_no = #{userNO};
		</update>
		
		

   </mapper>